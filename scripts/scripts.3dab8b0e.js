"use strict";function config(a){a.when("/",{template:"<main-component></main-component>"}).when("/login",{template:"<login-component></login-component>"}).otherwise({redirectTo:"/login"})}function run(a,b,c,d){a.globals=c.getObject("globals")||{},a.globals.currentUser&&(d.defaults.headers.common.Authorization=a.globals.currentUser.authdata),a.$on("$locationChangeStart",function(c,d,e){var f=-1===$.inArray(b.path(),["/login"]),g=a.globals.currentUser;f&&!g&&b.path("/login")})}function MainCtrl(a,b,c){function d(){h.username=a.globals.currentUser.username}function e(){b.GetAll().then(function(a){a.success?h.allProjects=a.data:c.Error(a.message)})}function f(a){b.Delete(a).then(function(a){a.success?e():c.Error(a.message)})}function g(){d(),e()}var h=this;h.allProjects=[],h.deleteProject=f,g()}function LoginCtrl(a,b,c){function d(){b.ClearCredentials()}var e=this;e.login=function(){e.dataLoading=!0,b.Login(e.username,e.password,function(d){d.success?(b.SetCredentials(e.username,d.data.token),a.path("/")):(c.Error(d.message),e.dataLoading=!1)})},d()}function AuthenticationService(a,b,c,d,e){function f(b,c,d){a.post(e.UserService+"api-token-auth/",{username:b,password:c}).then(function(a){a.success=!0,d(a)},function(a){a.data&&a.data.non_field_errors&&a.data.non_field_errors.length?a.message=a.data.non_field_errors[0]:a.message="Oops! Something went wrong. Please try again.",a.success=!1,d(a)})}function g(d,e){c.globals={currentUser:{username:d,authdata:e}},a.defaults.headers.common.Authorization=e;var f=new Date;f.setDate(f.getDate()+7),b.putObject("globals",c.globals,{expires:f})}function h(){c.globals={},b.remove("globals"),a.defaults.headers.common.Authorization=""}var i={};return i.Login=f,i.SetCredentials=g,i.ClearCredentials=h,i}function FlashService(a){function b(){function b(){var b=a.flash;b&&(b.keepAfterLocationChange?b.keepAfterLocationChange=!1:delete a.flash)}a.$on("$locationChangeStart",function(){b()})}function c(b,c){a.flash={message:b,type:"success",keepAfterLocationChange:c}}function d(b,c){a.flash={message:b,type:"error",keepAfterLocationChange:c}}var e={};return e.Success=c,e.Error=d,b(),e}function ProjectService(a,b){function c(){return a.get(b.ProjectService+"projects/").then(h,i("Error getting all projects"))}function d(c){return a.get(b.ProjectService+"projects/"+c).then(h,i("Error getting project by id"))}function e(c){return a.post(b.ProjectService+"projects/",c).then(h,i("Error creating project"))}function f(c){return a.put(b.ProjectService+"projects/"+c.id,c).then(h,i("Error updating project"))}function g(c){return a["delete"](b.ProjectService+"projects/"+c).then(h,i("Error deleting project"))}function h(a){return a.success=!0,a}function i(a){return function(){return{success:!1,message:a}}}var j={};return j.GetAll=c,j.GetById=d,j.Create=e,j.Update=f,j.Delete=g,j}angular.module("tangentDemoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(config).run(run),config.$inject=["$routeProvider"],run.$inject=["$rootScope","$location","$cookies","$http"],angular.module("tangentDemoApp").component("mainComponent",{templateUrl:"views/main.html",controller:MainCtrl,controllerAs:"vm"}),MainCtrl.$inject=["$rootScope","ProjectService","FlashService"],angular.module("tangentDemoApp").component("loginComponent",{templateUrl:"views/login.html",controller:LoginCtrl,controllerAs:"vm"}),LoginCtrl.$inject=["$location","AuthenticationService","FlashService"],angular.module("tangentDemoApp").factory("AuthenticationService",AuthenticationService),AuthenticationService.$inject=["$http","$cookies","$rootScope","$timeout","ServiceUrls"],angular.module("tangentDemoApp").factory("FlashService",FlashService),FlashService.$inject=["$rootScope"],angular.module("tangentDemoApp").factory("ProjectService",ProjectService),ProjectService.$inject=["$http","ServiceUrls"],angular.module("tangentDemoApp").constant("ServiceUrls",{UserService:"http://userservice.staging.tangentmicroservices.com:80/",ProjectService:"http://projectservice.staging.tangentmicroservices.com:80/api/v1/"}),angular.module("tangentDemoApp").run(["$templateCache",function(a){a.put("views/login.html",'<div class="col-md-6 col-md-offset-3"> <h2>Login</h2> <form name="form" ng-submit="vm.login()" role="form"> <div class="form-group" ng-class="{ \'has-error\': form.username.$dirty && form.username.$error.required }"> <label for="username">Username</label> <input type="text" name="username" id="username" class="form-control" ng-model="vm.username" required> <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span> </div> <div class="form-group" ng-class="{ \'has-error\': form.password.$dirty && form.password.$error.required }"> <label for="password">Password</label> <input type="password" name="password" id="password" class="form-control" ng-model="vm.password" required> <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span> </div> <div class="form-actions"> <button type="submit" ng-disabled="form.$invalid || vm.dataLoading" class="btn btn-primary">Login</button> <img ng-if="vm.dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="> </div> </form> </div>'),a.put("views/main.html",'<div class="row"> <div class="col-md-10"><h1>Hi {{vm.username}}</h1></div> <p class="col-md-2 text-right"><a href="#!/login" class="btn btn-default btn-logout">Logout</a></p> </div> <h3>Projects</h3> <div class="list-group"> <div class="list-group-item" ng-repeat="project in vm.allProjects"> <h4 class="list-group-item-heading">{{project.title}}</h4> <p class="list-group-item-text"> <dl class="dl-horizontal"> <dt>Description</dt><dd>{{project.description}}</dd> <dt>Start date</dt><dd>{{project.start_date}}</dd> <dt>End date</dt><dd>{{project.end_date}}</dd> <dt>Active</dt><dd><input type="checkbox" ng-model="project.is_active" disabled></dd> <dt>Billable</dt><dd><input type="checkbox" ng-model="project.is_billable" disabled></dd> </dl> <!-- @todo: -<a>Edit</a>--> <!-- @todo: -<a ng-click="vm.deleteProject(project.id)">Delete</a>--> </p> </div> </div>')}]);